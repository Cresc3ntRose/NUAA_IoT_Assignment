# [M2] 协程库

* `co_start` 函数用于创建并启动一个新的协程，将新协程添加到协程池中. 如果是第一次调用，会初始化 main 协程.
* `co_wait` 函数用于等待一个协程执行完毕. 当前协程的状态会被设置为 `CO_WAITING`，并将自己设置为等待的协程的 `waiter`. 然后通过不断调用 `co_yield` 来让出执行权，直到等待的协程状态变为 `CO_DEAD`.
* `co_yield` 函数是协程切换的核心. 它会保存当前协程的寄存器现场，然后在协程池中选择一个可以执行的协程，将其设置为当前协程. 如果选择的协程是新创建的，则切换到该协程的堆栈，并调用其入口函数；如果选择的协程已经执行过，则直接恢复其寄存器现场.
* `stack_switch_call` 函数用于切换堆栈并执行协程的入口函数，通过内联汇编实现. 它会将当前的栈指针保存到协程的堆栈中，然后切换到协程的堆栈，并调用协程的入口函数，最后再切换回原来的堆栈.